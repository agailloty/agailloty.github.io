<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>L'inversion de dépendance en C# (ID de SOLID) - AXEL-CLERIS GAILLOTY</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://agailloty.github.io/favicon.png><link rel=stylesheet href=/css/style.min.6b89cc86c0b843a772cdd6c6a8b7e11c2116c7933f6163d2ef225a87e1d2c121.css><meta name=description content="L'inversion de dépendance est un des principes de SOLID et stipule qu'une classe ne doit pas dépendre de l'implémentation de la classe dépendante mais plutôt sur une abastraction de celle-ci."><meta property="og:title" content="L'inversion de dépendance en C# (ID de SOLID)"><meta property="og:type" content="website"><meta property="og:url" content="https://agailloty.github.io/fr/posts/inversion-dependance/"><meta property="og:description" content="L'inversion de dépendance est un des principes de SOLID et stipule qu'une classe ne doit pas dépendre de l'implémentation de la classe dépendante mais plutôt sur une abastraction de celle-ci."><meta name=twitter:card content="summary"><meta name=twitter:site content="@zerostaticio"><meta name=twitter:creator content="@zerostaticio"><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel=stylesheet></head><body class='page frame page-blog-single'><div id=menu-main-mobile class=menu-main-mobile><ul class=menu><li class=menu-item-home><a href=https://agailloty.github.io/fr/>Home</a></li><li class=menu-item-blog><a href=https://agailloty.github.io/fr/posts/>Blog</a></li><li class=menu-item-about><a href=https://agailloty.github.io/fr/about/>About</a></li></ul></div><div id=wrapper class=wrapper><div class=header><a class=header-logo href=/fr/>AXEL-CLERIS GAILLOTY</a><div class=menu-main><ul><li class=menu-item-home><a href=/><span>Home</span></a></li><li class="menu-item-blog active"><a href=/fr/posts/><span>Blog</span></a></li><li class=menu-item-about><a href=/fr/about/><span>About</span></a></li></ul></div><div id=toggle-menu-main-mobile class=hamburger-trigger><button class=hamburger>Menu</button></div></div><div class=blog><div class=author><img width=30 class=author-image src=/images/author.jpg>
<span class=author-name>Axel-Cleris Gailloty</span>
<span class=author-divider></span>
<span class=author-date>octobre 14, 2022</span></div><div class=intro><h1>L'inversion de dépendance en C# (ID de SOLID)<span class=dot>.</span></h1></div><div class=content><h1 id=introduction--définition>Introduction & définition</h1><p>L’inversion de dépendance est un des principes de l&rsquo;approche SOLID. Elle traite de la question du couplage entre les différentes classes ou modules de votre application.
L&rsquo;inversion de dépendance fait intervenir les notions de classe supérieure et de classes inférieures. La classe supérieure dépend d&rsquo;une ou de plusieurs classes inférieures. La devise principale de l’inversion de dépendance est <strong>Toute classe supérieure devrait toujours dépendre de l’abstraction de la classe inférieure plutôt que de l&rsquo;implémentation de cette dernière</strong>.</p><p>Enoncer ce principe via sa devise ne suffit pas saisir entièrement ce que l&rsquo;inversion de dépendance représente en réalité. Nous allons donc écrire du code C# pour voir l&rsquo;application de ce principe en action.</p><h1 id=exemple>Exemple</h1><p>Pour mieux saisir le principe de l&rsquo;inversion de dépendance, il me semble pertinent d&rsquo;étudier un exemple pratique.
Supposons que nous ayons une classe principale (supérieure) nommée <code>TradeProcessor</code>. Cette classe se charge de lire des données à partir d&rsquo;une source, puis elle retraite les données brutes et les stocke quelque part.</p><p>Elle dépend des trois classes suivantes :</p><ul><li><code>DataProvider</code> qui fournit à la classe un ensemble de méthodes pour récupérer les données brutes.</li><li><code>DataParser</code> qui est une classe qui contient des méthodes pour traiter les données et les rendre prêtes à stocker.</li><li><code>DataStorage</code> qui est une classe qui se charge de stocker les données dans une base de données et d&rsquo;écrire des logs.</li></ul><h2 id=implémentation-sans-inversion-de-dépendance>Implémentation sans inversion de dépendance</h2><p>Nous présentons un à un le code de chacune de ces classes.</p><h3 id=la-classe-tradeprocessor>La classe <code>TradeProcessor</code></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>namespace</span> <span class=nn>DependencyInversionInjection</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>class</span> <span class=nc>TradeProcessor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>readonly</span> <span class=n>DataProvider</span> <span class=n>_data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>readonly</span> <span class=n>DataParser</span> <span class=n>_parser</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>readonly</span> <span class=n>DataStorage</span> <span class=n>_storage</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=n>TradeProcessor</span><span class=p>(</span><span class=n>DataProvider</span> <span class=n>data</span><span class=p>,</span> <span class=n>DataParser</span> <span class=n>parser</span><span class=p>,</span> <span class=n>DataStorage</span> <span class=n>storage</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>_data</span> <span class=p>=</span> <span class=n>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>_parser</span> <span class=p>=</span> <span class=n>parser</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>_storage</span> <span class=p>=</span> <span class=n>storage</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>void</span> <span class=n>ProcessTrade</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>lines</span> <span class=p>=</span> <span class=n>_data</span><span class=p>.</span><span class=n>GetAll</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>trades</span> <span class=p>=</span> <span class=n>_parser</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>lines</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>_storage</span><span class=p>.</span><span class=n>Persist</span><span class=p>(</span><span class=n>trades</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=la-classe-dataprovider>La classe <code>DataProvider</code></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>DataProvider</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>readonly</span> <span class=n>StreamReader</span> <span class=n>_reader</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=n>DataProvider</span><span class=p>(</span><span class=kt>string</span> <span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>_reader</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StreamReader</span><span class=p>(</span><span class=n>path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Read raw text from specified path</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>GetAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>             <span class=kt>var</span> <span class=n>rawData</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span><span class=p>(</span><span class=n>_reader</span><span class=p>.</span><span class=n>ReadLine</span><span class=p>()</span> <span class=p>!=</span> <span class=k>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>rawData</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>_reader</span><span class=p>.</span><span class=n>ReadLine</span><span class=p>());</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>rawData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h3 id=la-classe-dataparser>La classe <code>DataParser</code></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>DataParser</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>UserData</span><span class=p>&gt;</span> <span class=n>Parse</span><span class=p>(</span><span class=n>List</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>string</span><span class=p>[]</span> <span class=n>currentData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>UserData</span> <span class=n>userData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>List</span><span class=p>&lt;</span><span class=n>UserData</span><span class=p>&gt;</span> <span class=n>result</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>UserData</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=kt>string</span> <span class=n>line</span> <span class=k>in</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>currentData</span> <span class=p>=</span> <span class=n>line</span><span class=p>.</span><span class=n>Split</span><span class=p>(</span><span class=sc>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>userData</span> <span class=p>=</span> <span class=k>new</span> <span class=n>UserData</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=n>userData</span><span class=p>.</span><span class=n>ID</span> <span class=p>=</span> <span class=n>Guid</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>currentData</span><span class=p>[</span><span class=m>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                <span class=n>userData</span><span class=p>.</span><span class=n>Name</span> <span class=p>=</span> <span class=n>currentData</span><span class=p>[</span><span class=m>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>userData</span><span class=p>.</span><span class=n>PhoneNumber</span> <span class=p>=</span> <span class=n>currentData</span><span class=p>[</span><span class=m>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>userData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>class</span> <span class=nc>UserData</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=n>Guid</span> <span class=n>ID</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=kt>string</span> <span class=n>Name</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=kt>string</span> <span class=n>PhoneNumber</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h3 id=la-classe-datastorage>La classe <code>DataStorage</code></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>public</span> <span class=k>class</span> <span class=nc>DataStorage</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>void</span> <span class=n>Persist</span><span class=p>(</span><span class=n>List</span><span class=p>&lt;</span><span class=n>UserData</span><span class=p>&gt;</span> <span class=n>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>json</span> <span class=p>=</span> <span class=n>JsonSerializer</span><span class=p>.</span><span class=n>Serialize</span><span class=p>(</span><span class=n>users</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>File</span><span class=p>.</span><span class=n>WriteAllText</span><span class=p>(</span><span class=s>&#34;cleaned.json&#34;</span><span class=p>,</span> <span class=n>json</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h2 id=implémentation-avec-inversion-de-dépendance>Implémentation avec inversion de dépendance</h2><h2 id=les-interfaces-en-c>Les interfaces en C#</h2><h2 id=créer-des-interfaces-pour-chacune-des-classes>Créer des interfaces pour chacune des classes</h2><h3 id=extraire-linterface-dune-classe>Extraire l&rsquo;interface d&rsquo;une classe</h3><p>Il est possible d&rsquo;extraire une interface à partir d&rsquo;une classe existante grâce à Visual Studio.
Pour extraire une interface à partir d&rsquo;une classe. Placez votre souris sur le nom de classe puis faites un clic droit. Un memu contextuel s&rsquo;affiche.</p><p><img src=/blog/dependency-injection-inversion/extract-interface-1.png alt></p><p>Ensuite sélectionner la première option <em>Actions rapides et factorisations&mldr;</em>.
<img src=/blog/dependency-injection-inversion/extract-interface-2.png alt></p><p>Vous avez ensuite le choix des propriétés et méthodes publiques à inclure dans l&rsquo;interface. Une fois que cela est fait cliquez sur OK pour que Visual Studio vous crée un fichier contenant l&rsquo;interface. Vous pouvez choisir d&rsquo;inclure le code de l&rsquo;interface directement dans le fichier.</p><p><img src=/blog/dependency-injection-inversion/extract-interface-3.png alt></p><h2 id=implémentation-avec-linversion-de-la-dépendance>Implémentation avec l&rsquo;inversion de la dépendance</h2><p>L&rsquo;idée ici c&rsquo;est de faire en sorte que la classe <code>TradeProcessor</code> ne dépende pas des classes inférieures mais qu&rsquo;elle dépende plutôt des abastractions de ces classes.
L&rsquo;élement que nous utilisons pour l&rsquo;abastraction est justement une interface.</p><p>Nous avons extrait les interfaces des classes inférieures, voilà donc comment nous implémentons la classe <code>TradeProcessor</code>, nous donnons le nom de <code>TradeProcessorDI</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>public</span> <span class=k>class</span> <span class=nc>TradeProcessorDI</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>readonly</span> <span class=n>IDataProvider</span> <span class=n>_data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>readonly</span> <span class=n>IDataParser</span> <span class=n>_parser</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>readonly</span> <span class=n>IDataStorage</span> <span class=n>_storage</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=n>TradeProcessorDI</span><span class=p>(</span><span class=n>IDataProvider</span> <span class=n>data</span><span class=p>,</span> <span class=n>IDataParser</span> <span class=n>parser</span><span class=p>,</span> <span class=n>IDataStorage</span> <span class=n>storage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>_data</span> <span class=p>=</span> <span class=n>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>_parser</span> <span class=p>=</span> <span class=n>parser</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>_storage</span> <span class=p>=</span> <span class=n>storage</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>void</span> <span class=n>ProcessTrade</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>lines</span> <span class=p>=</span> <span class=n>_data</span><span class=p>.</span><span class=n>GetAll</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>trades</span> <span class=p>=</span> <span class=n>_parser</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>lines</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>_storage</span><span class=p>.</span><span class=n>Persist</span><span class=p>(</span><span class=n>trades</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>Vous remarquerez que peu de choses diffèrent entre les classes <code>TradeDataProcessor</code> et <code>TradeDataProcessorDI</code>. En fait nous avons seulement remplacé les noms des classes inférieures par les noms de leurs interfaces.
La classe fonctionne exactement pareil.</p><p>La méthode <code>Main</code> de notre programme fonctionne exactement pareil avec les deux classes <code>TradeDataProcessor</code> et <code>TradeDataProcessorDI</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>public</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>data</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DataProvider</span><span class=p>(</span><span class=s>&#34;data/rawData.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>parser</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DataParser</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>storage</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DataStorage</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>processor</span> <span class=p>=</span> <span class=k>new</span> <span class=n>TradeDataProcessorDI</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>parser</span><span class=p>,</span> <span class=n>storage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>processor</span><span class=p>.</span><span class=n>ProcessTrade</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>public</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>data</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DataProvider</span><span class=p>(</span><span class=s>&#34;data/rawData.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>parser</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DataParser</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>storage</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DataStorage</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>processor</span> <span class=p>=</span> <span class=k>new</span> <span class=n>TradeDataProcessor</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>parser</span><span class=p>,</span> <span class=n>storage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>processor</span><span class=p>.</span><span class=n>ProcessTrade</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h1 id=quel-intérêt->Quel intérêt ?</h1><p>Vous pouvez vous dire mais à quoi ça sert de faire toute cette bidouille pour arriver à la même solution qu&rsquo;avec la première classe.
En fait nous venons d&rsquo;inverser les dépendances de la classe TradeDataProcessor. Cela signifie que la classe TradeDataProcessorDI peut prendre en argument dans son constructeur non seulement les classe <code>DataProvider</code>, <code>DataParser</code> et <code>DataStorage</code> mais aussi n&rsquo;importe quelle classe qui implémente les interfaces <code>IDataProvider</code>, <code>IDataParser</code> et <code>IDataStorage</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>public</span> <span class=k>class</span> <span class=nc>XMLDataStorage</span> <span class=p>:</span> <span class=n>IDataStorage</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>void</span> <span class=n>Persist</span><span class=p>(</span><span class=n>List</span><span class=p>&lt;</span><span class=n>UserData</span><span class=p>&gt;</span> <span class=n>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>using</span> <span class=p>(</span><span class=n>XmlWriter</span> <span class=n>writer</span> <span class=p>=</span> <span class=n>XmlWriter</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=s>&#34;users.xml&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>writer</span><span class=p>.</span><span class=n>WriteStartElement</span><span class=p>(</span><span class=s>&#34;UserData&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>foreach</span><span class=p>(</span><span class=n>UserData</span> <span class=n>user</span> <span class=k>in</span> <span class=n>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>writer</span><span class=p>.</span><span class=n>WriteElementString</span><span class=p>(</span><span class=s>&#34;Id&#34;</span><span class=p>,</span> <span class=n>user</span><span class=p>.</span><span class=n>ID</span><span class=p>.</span><span class=n>ToString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>writer</span><span class=p>.</span><span class=n>WriteElementString</span><span class=p>(</span><span class=s>&#34;Name&#34;</span><span class=p>,</span> <span class=n>user</span><span class=p>.</span><span class=n>Name</span><span class=p>.</span><span class=n>ToString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>writer</span><span class=p>.</span><span class=n>WriteElementString</span><span class=p>(</span><span class=s>&#34;Phone&#34;</span><span class=p>,</span> <span class=n>user</span><span class=p>.</span><span class=n>PhoneNumber</span><span class=p>.</span><span class=n>ToString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=n>writer</span><span class=p>.</span><span class=n>WriteEndElement</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=n>writer</span><span class=p>.</span><span class=n>Flush</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>public</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>data</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DataProvider</span><span class=p>(</span><span class=s>&#34;data/rawData.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>parser</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DataParser</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>storage</span> <span class=p>=</span> <span class=k>new</span> <span class=n>XMLDataStorage</span><span class=p>();</span> <span class=c1>// Nouvelle classe de stockage des données</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>processor</span> <span class=p>=</span> <span class=k>new</span> <span class=n>TradeDataProcessorDI</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>parser</span><span class=p>,</span> <span class=n>storage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>processor</span><span class=p>.</span><span class=n>ProcessTrade</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="axel-cleris-gailloty",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class=footer><div class=footer-social><span class="social-icon social-icon-twitter"><a href=https://twitter.com/cleris_mr title=twitter target=_blank rel=noopener><img src=/images/social/twitter.svg width=24 height=24 alt=twitter></a></span>
<span class="social-icon social-icon-github"><a href=https://github.com/agailloty title=github target=_blank rel=noopener><img src=/images/social/github.svg width=24 height=24 alt=github></a></span>
<span class="social-icon social-icon-linkedin"><a href=https://fr.linkedin.com/in/cgailloty/ title=linkedin target=_blank rel=noopener><img src=/images/social/linkedin.svg width=24 height=24 alt=linkedin></a></span></div></div></div><script type=text/javascript src=/js/bundle.min.5993fcb11c07dea925a3fbd58c03c7f1857197c35fccce3aa963a12c0b3c9960.js></script></body></html>